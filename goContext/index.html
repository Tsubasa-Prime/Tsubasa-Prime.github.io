<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Tsubasa çš„æ—¥è®°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="ã‚ãŸã—ã€æ°—ã«ãªã‚Šã¾ã™! "/>
<meta name="keywords" content="ã‚ãŸã—ã€æ°—ã«ãªã‚Šã¾ã™! "/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://tsubasa597.github.io/favicon.ico">

<link rel="stylesheet" href="https://tsubasa597.github.io/styles/main.css">

<!-- Modernizr JS -->
<script src="https://tsubasa597.github.io/media/scripts/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://tsubasa597.github.io/media/scripts/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->



<!-- katex -->
<!--<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet">-->

<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">



</head>
<body>
    <div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://tsubasa597.github.io/images/avatar.png" alt="Tsubasa çš„æ—¥è®°"
                 class="img-responsive">
        </figure>
        <h2>Tsubasa çš„æ—¥è®°</h2>
        <p>ã‚ãŸã—ã€æ°—ã«ãªã‚Šã¾ã™! </p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">

        <!-- æ ‡ç­¾ -->
        <div class="fh5co-box">
            <a href="https://tsubasa597.github.io/tags/"><h3 class="heading">ğŸ‘‰æ ‡ç­¾</h3></a>
            <ul>
                
                    <li><a href="https://tsubasa597.github.io/tag/mysql/">MySql</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/go/">Golang</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/git/">Git</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/collections/">é›†åˆ</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/java/">Java</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/sort/">æ’åºç®—æ³•</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/dataStructure/">æ•°æ®ç»“æ„</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/list/">çº¿æ€§è¡¨</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/vim/">Vim</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/dwm/">Dwm</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/pytorch/">PyTorch</a></li>
                
                    <li><a href="https://tsubasa597.github.io/tag/deepLearning/">æ·±åº¦å­¦ä¹ </a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/archives"
                        
                        >
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                        
                        >
                            æ ‡ç­¾
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://tsubasa597.github.io">Tsubasa çš„æ—¥è®° </a>
                </h1>
            </div>
        </div>
    </div>
</header>


    <!--  <a href="#" class="fh5co-post-prev"><span>ğŸ‘ˆ Prev</span></a>-->
    <!--  <a href="#" class="fh5co-post-next"><span>Next ğŸ‘‰</span></a>-->

    <!-- ç­‰grideaå‡ºè‡ªå®šä¹‰é¡µé¢åŠŸèƒ½å†ä¼˜åŒ–ä¸€ä¸‹ -->
    
        <div class="container-fluid">
    <div class="row fh5co-post-entry single-entry">
        <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <figure class="animate-box">
                
                    <img src="https://tsubasa597.github.io/post-images/goContext.jpg" alt="Go Context æ ‡å‡†åº“" class="img-responsive">
                
            </figure>
            <span class="fh5co-meta animate-box">
                
                    <div class="tag-container">
                        
                            <a href="https://tsubasa597.github.io/tag/go/" class="tag">Golang, </a>
                        
                    </div>
                
            </span>
            <h2 class="fh5co-article-title animate-box">Go Context æ ‡å‡†åº“</h2>
            <ol class="breadcrumb fh5co-meta fh5co-date animate-box" style="margin-bottom:0; background-color:#f8f9fa">
                <li>2021-03-14</li>
                <li>2013å­—</li>
                <li>9 min read</li>
            </ol>

            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                <div class="row">
                    <div class="col-md-12 animate-box post-content">
                        <p> <!--more-->
<blockquote>
<blockquote>
<p>Go ä¸­çš„ goroutine ä¹‹é—´æ²¡æœ‰çˆ¶ä¸å­çš„å…³ç³»ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰€è°“å­è¿›ç¨‹é€€å‡ºåçš„é€šçŸ¥æœºåˆ¶ï¼Œå¤šä¸ª goroutine éƒ½æ˜¯å¹³è¡Œçš„è¢«è°ƒåº¦ï¼Œå¤šä¸ª goroutine å¦‚ä½•åä½œå·¥ä½œæ¶‰åŠé€šä¿¡ã€åŒæ­¥ã€é€šçŸ¥å’Œé€€å‡ºå››ä¸ªæ–¹é¢ã€‚</p>
<ul>
<li>é€šä¿¡ï¼šchan é€šé“å½“ç„¶æ˜¯ goroutine ä¹‹é—´é€šä¿¡çš„åŸºç¡€ï¼Œæ³¨æ„è¿™é‡Œçš„é€šä¿¡ä¸»è¦æ˜¯æŒ‡ç¨‹åºçš„æ•°æ®é€šé“ã€‚</li>
<li>åŒæ­¥ï¼šä¸å¸¦ç¼“å†²çš„ chan æä¾›äº†ä¸€ä¸ªå¤©ç„¶çš„åŒæ­¥ç­‰å¾…æœºåˆ¶ï¼›å½“ç„¶ sync.WaitGroup ä¹Ÿä¸ºå¤šä¸ª goroutine ååŒå·¥ä½œæä¾›ä¸€ç§åŒæ­¥ç­‰å¾…æœºåˆ¶ã€‚</li>
<li>é€šçŸ¥ï¼šè¿™ä¸ªé€šçŸ¥å’Œä¸Šé¢é€šä¿¡çš„æ•°æ®ä¸ä¸€æ ·ï¼Œé€šçŸ¥é€šå¸¸ä¸æ˜¯ä¸šåŠ¡æ•°æ®ï¼Œè€Œæ˜¯ç®¡ç†ã€æ§åˆ¶æµæ•°æ®ã€‚</li>
<li>é€€å‡ºï¼šgoroutine ä¹‹é—´æ²¡æœ‰çˆ¶å­å…³ç³»ï¼Œå¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªå•ç‹¬çš„é€šé“ï¼Œå€ŸåŠ©é€šé“å’Œ select çš„å¹¿æ’­æœºåˆ¶å®ç°é€€å‡ºã€‚</li>
</ul>
</blockquote>
</blockquote>
<h1 id="context-çš„è®¾è®¡ç›®çš„">Context çš„è®¾è®¡ç›®çš„</h1>
<p>context åº“çš„è®¾è®¡ç›®çš„å°±æ˜¯è·Ÿè¸ª goroutine è°ƒç”¨æ ‘ï¼Œå¹¶åœ¨è¿™äº› goroutine è°ƒç”¨æ ‘ä¸­ä¼ é€’é€šçŸ¥å’Œå…ƒæ•°æ®ã€‚ä¸¤ä¸ªç›®çš„ï¼š</p>
<ol>
<li>é€€å‡ºé€šçŸ¥æœºåˆ¶â€”â€”é€šçŸ¥å¯ä»¥ä¼ é€’ç»™æ•´ä¸ª goroutine è°ƒç”¨æ ‘ä¸Šçš„æ¯ä¸€ä¸ª goroutineã€‚</li>
<li>ä¼ é€’æ•°æ®â€”â€”æ•°æ®å¯ä»¥ä¼ é€’ç»™æ•´ä¸ª goroutine è°ƒç”¨æ ‘ä¸Šçš„æ¯ä¸€ä¸ª goroutineã€‚</li>
</ol>
<h1 id="åŸºæœ¬æ•°æ®ç»“æ„">åŸºæœ¬æ•°æ®ç»“æ„</h1>
<h2 id="æ¥å£">æ¥å£</h2>
<h3 id="context">Context</h3>
<p>Context æ˜¯ä¸€ä¸ªåŸºæœ¬æ¥å£ï¼Œæ‰€æœ‰çš„ Context å¯¹è±¡éƒ½è¦å®ç°è¯¥æ¥å£ï¼Œcontext çš„ä½¿ç”¨è€…åœ¨è°ƒç”¨æ¥å£éƒ½ä½¿ç”¨ Context ä½œä¸ºå‚æ•°ç±»å‹ã€‚</p>
<pre><code class="language-go">type Context interface {
    // å¦‚æœ Context å®ç°äº†è¶…æ—¶æ§åˆ¶ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å› ok trueï¼Œdeadline ä¸ºè¶…æ—¶æ—¶é—´ï¼Œå¦åˆ™ ok ä¸ºfalse
    Deadline()

    // åç«¯è¢«è°ƒçš„ goroutine åº”è¯¥ç›‘å¬è¯¥æ–¹æ³•è¿”å›çš„ chanï¼Œä»¥ä¾¿åŠæ—¶é‡Šæ”¾èµ„æºã€‚
    Done() &lt;-chan struct {}

    // Done() è¿”å›çš„ chan æ”¶åˆ°é€šçŸ¥çš„æ—¶å€™ï¼Œæ‰å¯ä»¥è®¿é—® Err() è·çŸ¥å› ä¸ºä»€ä¹ˆåŸå› è¢«å–æ¶ˆ
    Err() error

    // å¯ä»¥è®¿é—®ä¸Šæ¸¸ goroutine ä¼ é€’ç»™ä¸‹æ¸¸ goroutine çš„å€¼
    Value(key interface{}) interface{}
}
</code></pre>
<h3 id="canceler">canceler</h3>
<p>canceler æ¥å£æ˜¯ä¸€ä¸ªæ‹“å±•æ¥å£ï¼Œè§„å®šäº†å–æ¶ˆé€šçŸ¥çš„ Context å…·ä½“ç±»å‹éœ€è¦å®ç°çš„æ¥å£ã€‚context åŒ…ä¸­çš„å…·ä½“ç±»å‹ *cancelCtx å’Œ *timerCtx éƒ½å®ç°äº†è¯¥æ¥å£ã€‚</p>
<pre><code class="language-go">// ä¸€ä¸ª context å¯¹è±¡å¦‚æœå®ç°äº† canceler æ¥å£ï¼Œåˆ™å¯ä»¥è¢«å–æ¶ˆã€‚

type canceler interface {
    // åˆ›å»º cancel æ¥å£å®ä¾‹çš„ goroutine è°ƒç”¨ cancel æ–¹æ³•é€šçŸ¥åç»­åˆ›å»ºçš„ goroutine é€€å‡º
    cancel(removeFromParent bool, err error)
    
    // Done æ–¹æ³•è¿”å›çš„ chan éœ€è¦åç«¯ç›‘å¬ï¼Œå¹¶åŠæ—¶é€€å‡º
    Done() &lt;-chan struct
}
</code></pre>
<h2 id="ç»“æ„ä½“">ç»“æ„ä½“</h2>
<h3 id="empty-context">empty Context</h3>
<p>emptyCtx å®ç°äº† Context æ¥å£ï¼Œä½†ä¸å…·å¤‡ä»»ä½•åŠŸèƒ½ï¼Œå› ä¸ºå…¶æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ç©ºå®ç°ã€‚å…¶å­˜åœ¨çš„ç›®çš„æ˜¯ä½œä¸º Context å¯¹è±¡æ ‘çš„æ ¹ï¼ˆroot èŠ‚ç‚¹ï¼‰ã€‚ å› ä¸º context åŒ…çš„ä½¿ç”¨æ€è·¯å°±æ˜¯ä¸åœçš„è°ƒç”¨ context åŒ…æä¾›çš„åŒ…è£…å‡½æ•°æ¥åˆ›å»ºå…·æœ‰ç‰¹æ®ŠåŠŸèƒ½çš„ Context å®ä¾‹ï¼Œæ¯ä¸€ä¸ª Context å®ä¾‹çš„åˆ›å»ºéƒ½ä»¥ä¸Šä¸€ä¸ª Context å¯¹è±¡ä¸ºå‚æ•°ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªæ ‘çŠ¶çš„ç»“æ„ã€‚</p>
<pre><code class="language-go">// emptyCtx å®ç°äº† Context æ¥å£
type emptyCtx int

func (*emptyCtx) Deadline() (deadline time.Time, ok bool) {
    return
}

func (*emptyCtx) Done() &lt;-chan struct{} {
    return nil
}

func (*emptyCtx) Err() error {
    return nil
}

func (*emptyCtx) Value(key interface{}) interface{} {
    return nil
}

func (e *emptyCtx) String() string {
    switch e {
        case background:
            return &quot;context.Background&quot;
        case todo:
            return &quot;context.TODO&quot;
    }
    return &quot;unknow empty Context&quot;
}
</code></pre>
<p>package å®šä¹‰äº†ä¸¤ä¸ªå…¨å±€å˜é‡å’Œä¸¤ä¸ªå°è£…å‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ª emptyCtx å®ä¾‹å¯¹è±¡ï¼Œå®é™…ä½¿ç”¨æ—¶é€šè¿‡è°ƒç”¨è¿™ä¸¤ä¸ªå°è£…å‡½æ•°æ¥æ„é€  Context çš„ root èŠ‚ç‚¹ã€‚</p>
<pre><code class="language-go">var (
    background = new(emptyCtx)
    todo = new(emptyCtx)
)

func Background() Context {
    return background
}

func TODO() Context {
    return todo
}
</code></pre>
<h3 id="cancelctx">cancelCtx</h3>
<p>cnacelCtx æ˜¯ä¸€ä¸ªå®ç°äº† Context æ¥å£çš„å…·ä½“ç±»å‹ï¼ŒåŒæ—¶å®ç°äº† conceler æ¥å£ã€‚conceler å…·æœ‰é€€å‡ºé€šçŸ¥æ–¹æ³•ã€‚æ³¨æ„é€€å‡ºé€šçŸ¥æœºåˆ¶ä¸ä½†èƒ½é€šçŸ¥è‡ªå·±ï¼Œä¹Ÿèƒ½é€å±‚é€šçŸ¥å…¶ children èŠ‚ç‚¹ã€‚</p>
<pre><code class="language-go">type cancelCtx struct {
    Context

    done chan struct{}

    mu sync.Mutex
    children map[canceler]bool
    err error
}

func (c *cancelCtx) Done() &lt;-chan struct{} {
    return c.done
}

func (c *cancelCtx) Err() error {
    c.mu.Lock()
    defer c.mu.Unlock()
    return c.err
}

func (c *cancelCtx) String string {
    return fmt.Sprintf(&quot;%v.WithCancel&quot;, c.Cointext)
}

func (c *cancelCtx) cancel(removeFromParent bool, err error) {
	if err == nil {
		panic(&quot;context: internal error: missing cancel error&quot;)
	}
	c.mu.Lock()
	if c.err != nil {
		c.mu.Unlock()
		return // already canceled
	}
	c.err = err
    // æ˜¾ç¤ºé€šçŸ¥è‡ªå·±
	if c.done == nil {
		c.done = closedchan
	} else {
		close(c.done)
	}
    // å¾ªç¯è°ƒç”¨ childern çš„ cancel å‡½æ•°ï¼Œç”±äº parent å·²ç»å–æ¶ˆï¼Œæ‰€ä»¥æ­¤æ—¶ child è°ƒç”¨ cancel ä¼ å…¥çš„æ˜¯ false
	for child := range c.children {
		// NOTE: acquiring the child's lock while holding parent's lock.
		child.cancel(false, err)
	}
	c.children = nil
	c.mu.Unlock()

	if removeFromParent {
		removeChild(c.Context, c)
	}
}
</code></pre>
<h3 id="timerctx">timerCtx</h3>
<p>timerCtx æ˜¯ä¸€ä¸ªå®ç°äº† Context æ¥å£çš„å…·ä½“ç±»å‹ï¼Œå†…éƒ¨å°è£…äº† cancelCtx ç±»å‹å®ä¾‹ï¼ŒåŒæ—¶æ‹¥æœ‰ä¸€ä¸ª deadline å˜é‡ï¼Œç”¨æ¥å®ç°å®šæ—¶é€€å‡ºé€šçŸ¥ã€‚</p>
<pre><code class="language-go">type timerCtx struct {
	cancelCtx
	timer *time.Timer // Under cancelCtx.mu.

	deadline time.Time
}

func (c *timerCtx) Deadline() (deadline time.Time, ok bool) {
	return c.deadline, true
}

func (c *timerCtx) String() string {
	return contextName(c.cancelCtx.Context) + &quot;.WithDeadline(&quot; +
		c.deadline.String() + &quot; [&quot; +
		time.Until(c.deadline).String() + &quot;])&quot;
}

func (c *timerCtx) cancel(removeFromParent bool, err error) {
	c.cancelCtx.cancel(false, err)
	if removeFromParent {
		// Remove this timerCtx from its parent cancelCtx's children.
		removeChild(c.cancelCtx.Context, c)
	}
	c.mu.Lock()
	if c.timer != nil {
		c.timer.Stop()
		c.timer = nil
	}
	c.mu.Unlock()
}
</code></pre>
<h3 id="valuectx">valueCtx</h3>
<p>valueCtx æ˜¯ä¸€ä¸ªå®ç°äº† Context æ¥å£çš„å…·ä½“ç±»å‹ï¼Œå†…éƒ¨å°è£…äº† Context æ¥å£ç±»å‹ï¼ŒåŒæ—¶å°è£…äº†ä¸€ä¸ª k/v çš„å‚¨å­˜å˜é‡ã€‚valueCtx å¯ç”¨æ¥ä¼ é€’é€šçŸ¥ä¿¡æ¯ã€‚</p>
<pre><code class="language-go">type valueCtx struct {
	Context
	key, val interface{}
}

// stringify tries a bit to stringify v, without using fmt, since we don't
// want context depending on the unicode tables. This is only used by
// *valueCtx.String().
func stringify(v interface{}) string {
	switch s := v.(type) {
	case stringer:
		return s.String()
	case string:
		return s
	}
	return &quot;&lt;not Stringer&gt;&quot;
}

func (c *valueCtx) String() string {
	return contextName(c.Context) + &quot;.WithValue(type &quot; +
		reflectlite.TypeOf(c.key).String() +
		&quot;, val &quot; + stringify(c.val) + &quot;)&quot;
}

func (c *valueCtx) Value(key interface{}) interface{} {
	if c.key == key {
		return c.val
	}
	return c.Context.Value(key)
}
</code></pre>
<h1 id="api-å‡½æ•°">API å‡½æ•°</h1>
<p>ä¸‹é¢ä¸¤ä¸ªå‡½æ•°æ˜¯æ„é€  Context å–æ¶ˆæ ‘çš„æ ¹èŠ‚ç‚¹å¯¹è±¡ï¼Œæ ¹èŠ‚ç‚¹å¯¹è±¡ç”¨ä½œåç»­ With åŒ…è£…å‡½æ•°çš„å®å‚ã€‚</p>
<pre><code class="language-go">func Background() Context
func TODO() COntext
</code></pre>
<p>With åŒ…è£…å‡½æ•°ç”¨æ¥æ„å»ºä¸åŒåŠŸèƒ½çš„ Context å…·ä½“å¯¹è±¡ã€‚</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå¸¦æœ‰é€€å‡ºé€šçŸ¥çš„ Context å…·ä½“å¯¹è±¡ï¼Œå†…éƒ¨åˆ›å»ºä¸€ä¸ª cancelCtx çš„ç±»å‹å®ä¾‹ã€‚</li>
</ol>
<pre><code class="language-go">func WithCancel(parent Context) (ctx Context, cancel CancelFunc)
</code></pre>
<ol start="2">
<li>åˆ›å»ºä¸€ä¸ªå¸¦æœ‰è¶…æ—¶é€šçŸ¥çš„ Context å…·ä½“å¯¹è±¡ï¼Œå†…éƒ¨åˆ›å»ºä¸€ä¸ª timerCtx çš„ç±»å‹å®ä¾‹ã€‚</li>
</ol>
<pre><code class="language-go">func WithDeadline(parent Context, d time.Time) (Context, CancelFunc)
</code></pre>
<ol start="3">
<li>åˆ›å»ºä¸€ä¸ªå¸¦æœ‰è¶…æ—¶é€šçŸ¥çš„ Context å…·ä½“å¯¹è±¡ï¼Œå†…éƒ¨åˆ›å»ºä¸€ä¸ª timerCtx çš„ç±»å‹å®ä¾‹ã€‚</li>
</ol>
<pre><code class="language-go">func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)
</code></pre>
<ol start="4">
<li>åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿä¼ é€’æ•°æ®çš„ Context å…·ä½“å¯¹è±¡ï¼Œå†…éƒ¨åˆ›å»ºä¸€ä¸ª valueCtx çš„ç±»å‹å®ä¾‹ã€‚</li>
</ol>
<pre><code class="language-go">func WithValue(parent Context, key, val interface{}) Context
</code></pre>
<p>è¿™äº›å‡½æ•°éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹â€”â€”parent å‚æ•°ï¼Œå…¶å®è¿™å°±æ˜¯å®ç° Context é€šçŸ¥æ ‘çš„å¿…å¤‡æ¡ä»¶ã€‚åœ¨ goroutine çš„è°ƒç”¨é“¾ä¸­ï¼ŒContext çš„å®ä¾‹è¢«é€å±‚çš„åŒ…è£…å¹¶ä¼ é€’ï¼Œæ¯å±‚åˆå¯ä»¥å¯¹ä¼ è¿›æ¥çš„ Context å®ä¾‹å†å°è£…è‡ªå·±æ‰€éœ€çš„åŠŸèƒ½ï¼Œæ•´ä¸ªè°ƒç”¨æ ‘éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ç»´æŠ¤ï¼Œè¿™ä¸ªç»´æŠ¤é€»è¾‘åœ¨è¿™äº›åŒ…è£…å‡½æ•°çš„å†…éƒ¨å®ç°ã€‚</p>
<h1 id="ä½¿ç”¨-context-ä¼ é€’æ•°æ®çš„äº‰è®®">ä½¿ç”¨ context ä¼ é€’æ•°æ®çš„äº‰è®®</h1>
<h2 id="è¯¥ä¸è¯¥ä½¿ç”¨-context-ä¼ é€’æ•°æ®">è¯¥ä¸è¯¥ä½¿ç”¨ context ä¼ é€’æ•°æ®</h2>
<p>é¦–å…ˆè¦æ¸…æ¥šä½¿ç”¨ context åŒ…ä¸»è¦æ˜¯è§£å†³ goroutine çš„é€šçŸ¥é€€å‡ºï¼Œä¼ é€’æ•°æ®æ˜¯å…¶ä¸€ä¸ªé¢å¤–åŠŸèƒ½ã€‚å¯ä»¥åœ¨ä½¿ç”¨å®ƒä¼ é€’ä¸€äº›å…ƒä¿¡æ¯ï¼Œæ€»ä¹‹ä½¿ç”¨ context ä¼ é€’çš„ä¿¡æ¯ä¸èƒ½å½±å“æ­£å¸¸çš„ä¸šåŠ¡æµç¨‹ï¼Œç¨‹åºä¸è¦æœŸå¾…åœ¨ context ä¸­ä¼ é€’ä¸€äº›å¿…é¡»çš„å‚æ•°ç­‰ï¼Œæ²¡æœ‰è¿™äº›å‚æ•°ï¼Œç¨‹åºä¹Ÿåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<h2 id="åœ¨-context-ä¸­ä¼ é€’æ•°æ®çš„åå¤„">åœ¨ context ä¸­ä¼ é€’æ•°æ®çš„åå¤„</h2>
<ol>
<li>ä¼ é€’çš„éƒ½æ˜¯ interface{} ç±»å‹çš„å€¼ï¼Œç¼–è¯‘å™¨ä¸èƒ½è¿›è¡Œä¸¥æ ¼çš„ç±»å‹æ ¡éªŒã€‚</li>
<li>ä» interface{} åˆ°å…·ä½“ç±»å‹éœ€è¦ä½¿ç”¨ç±»å‹æ–­è¨€å’Œæ¥å£æŸ¥è¯¢ï¼Œæœ‰ä¸€å®šçš„è¿è¡ŒæœŸå¼€é”€å’Œæ€§èƒ½æŸå¤±ã€‚</li>
<li>å€¼åœ¨ä¼ é€’è¿‡ç¨‹ä¸­æœ‰å¯èƒ½è¢«åç»­çš„æœåŠ¡è¦†ç›–ï¼Œä¸”ä¸æ˜“è¢«å‘ç°ã€‚</li>
<li>ä¼ é€’ä¿¡æ¯ä¸ç®€æ˜ï¼Œè¾ƒæ™¦æ¶©ï¼›ä¸èƒ½é€šè¿‡ä»£ç æ–‡æ¡£ä¸€çœ¼çœ‹åˆ°ä¼ é€’çš„æ˜¯ä»€ä¹ˆï¼Œä¸åˆ©äºåç»­ç»´æŠ¤ã€‚</li>
</ol>
<h2 id="context-åº”å½“ä¼ é€’ä»€ä¹ˆå‚æ•°">context åº”å½“ä¼ é€’ä»€ä¹ˆå‚æ•°</h2>
<ol>
<li>æ—¥å¿—ä¿¡æ¯</li>
<li>è°ƒè¯•ä¿¡æ¯</li>
<li>ä¸å½±å“ä¸šåŠ¡ä¸»é€»è¾‘çš„å¯é€‰æ•°æ®</li>
</ol>
<p>context åŒ…æä¾›çš„æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯å¤šä¸ª goroutine ä¹‹é—´çš„é€€å‡ºé€šçŸ¥æœºåˆ¶ï¼Œä¼ é€’æ•°æ®åªæ˜¯ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½ï¼Œåº”è°¨æ…ä½¿ç”¨ context ä¼ é€’æ•°æ®ã€‚</p>
 </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 animate-box">
                        
                            <div class="next-post">
                                <div class="next">ä¸‹ä¸€ç¯‡</div>
                                <a href="https://tsubasa597.github.io/goSync/">
                                    <h3 class="post-title">
                                        Go åŒæ­¥ä¸é”
                                    </h3>
                                </a>
                            </div>
                        
                    </div>
                </div>

                <div class="row">
    <div class="col-md-12 animate-box">
        
    </div>
</div>

            </div>

        </article>
    </div>
</div>

    

    <!-- è¿”å›é¡¶éƒ¨ -->
    <div class="back-to-top">
    
        <a href="#!" id="tool-toc" class="hidden-xs hidden-sm">
            <i class="fa fa-map"></i>
        </a>
        <br>
    
    <a href="#top" class="hidden-xs hidden-sm"><i class="fa fa-paper-plane"></i></a>
</div>

<div class="post-toc animated fadeInRight hidden-xs hidden-sm" style="display: none;">
    <ul class="markdownIt-TOC">
<li><a href="#context-%E7%9A%84%E8%AE%BE%E8%AE%A1%E7%9B%AE%E7%9A%84">Context çš„è®¾è®¡ç›®çš„</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">åŸºæœ¬æ•°æ®ç»“æ„</a>
<ul>
<li><a href="#%E6%8E%A5%E5%8F%A3">æ¥å£</a>
<ul>
<li><a href="#context">Context</a></li>
<li><a href="#canceler">canceler</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93">ç»“æ„ä½“</a>
<ul>
<li><a href="#empty-context">empty Context</a></li>
<li><a href="#cancelctx">cancelCtx</a></li>
<li><a href="#timerctx">timerCtx</a></li>
<li><a href="#valuectx">valueCtx</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#api-%E5%87%BD%E6%95%B0">API å‡½æ•°</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-context-%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BA%89%E8%AE%AE">ä½¿ç”¨ context ä¼ é€’æ•°æ®çš„äº‰è®®</a>
<ul>
<li><a href="#%E8%AF%A5%E4%B8%8D%E8%AF%A5%E4%BD%BF%E7%94%A8-context-%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE">è¯¥ä¸è¯¥ä½¿ç”¨ context ä¼ é€’æ•°æ®</a></li>
<li><a href="#%E5%9C%A8-context-%E4%B8%AD%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E7%9A%84%E5%9D%8F%E5%A4%84">åœ¨ context ä¸­ä¼ é€’æ•°æ®çš„åå¤„</a></li>
<li><a href="#context-%E5%BA%94%E5%BD%93%E4%BC%A0%E9%80%92%E4%BB%80%E4%B9%88%E5%8F%82%E6%95%B0">context åº”å½“ä¼ é€’ä»€ä¹ˆå‚æ•°</a></li>
</ul>
</li>
</ul>

</div>


    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></p>
</footer>


    <!-- jQuery -->
<script src="https://tsubasa597.github.io/media/scripts/jquery.min.js"></script>
<!-- img lazy load -->
<script src="https://tsubasa597.github.io/media/scripts/jquery.lazyload.min.js"></script>
<!-- jQuery Easing -->
<script src="https://tsubasa597.github.io/media/scripts/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://tsubasa597.github.io/media/scripts/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://tsubasa597.github.io/media/scripts/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://tsubasa597.github.io/media/scripts/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://tsubasa597.github.io/media/scripts/md5.min.js"></script>
<!-- katex -->
<!--<script src="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js"></script>-->
<!-- highlight -->
<script src="https://tsubasa597.github.io/media/scripts/highlight.js"></script>
<!-- <script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script> -->

<script type="application/javascript">
    // ä»£ç é«˜äº®
    hljs.initHighlightingOnLoad();
    
	// img æ‡’åŠ è½½
    $(function () {
        $("img.lazy").lazyload({
            effect: "fadeIn",  // æ‡’åŠ è½½åŠ¨ç”»
            threshold: 180  // åœ¨å›¾ç‰‡è·ç¦»å±å¹•180pxæ—¶æå‰è½½å…¥
        });
        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // ç›®å½•
        $('#tool-toc').click(function () {
            $('.post-toc').toggle();
        });
    });

    
        var allImg = $("img");
        allImg.on("contextmenu", function () {
            return false;
        });
        allImg.on("dragstart", function () {
            return false;
        });
    
</script>




</body>
</html>
